<!-- multilang from inyeccion-codigo.md




DO NOT MODIFY DIRECTLY THIS FILE WAS GENERATED BY multilang.js




-->


# Code injection

> **Never, build ANY code by adding strings that contents data with strings that content code** of any language at any level: SQL, Javascript, HTML, CSS, JSON, yaml, etc...


<!--multilang buttons-->

language: ![English](https://raw.githubusercontent.com/codenautas/multilang/master/img/lang-en.png)
also available in:
[![Spanish](https://raw.githubusercontent.com/codenautas/multilang/master/img/lang-es.png)](inyeccion-codigo.md)


## What is data?


Data is any value that is introduced or edited by the user now or in the future (thinking in the life cycle of the project).


### How a user introuce or edit data?


  1. In a `input` field in a web page 
  2. In a value stored in the database when it has writes to write. 
  3. In a `URL` that get, post data to the backend (may be delete or any of the http methods)
  4. In any kind of files uploaded to the backend and then proccesed by it


### What means thinking in the future?


Supouse that the definition of the problem says 
*the system must set a maximum to A which is twice that of B*. You can write this:


```js
const COEF_A_B=2;

await query('update t1 set A = min($1, '+COEF_A_B+' * B)) where...', [params.requested_a]);
```


That is safe today, because `COEF_A_B` is a numeric constant that the user cannot edit. 
But int the future many lines could be added between `const` and `query`. 
Later someone can decide that `COEF_A_B` may be stored in the database and edited by a manager. 
Then the code becomes unsafe. 

In my opinion the code was unsafe from the beginning.


## code injection in SQL


How to avoid it?

> **Never, build SQL code by adding strings that contents data**


If you can, send the data separately.


```js
⛔ await query("update t1 set c1='"+v1+"'") 
👍 await query("update t1 set c1 = $1", [v1])
```


If you can't send the data separately, i.e. you need to build a large sql programmatically quote the data.


Building it in Javascript:


```js
⛔ "update t1 set c1='"+v1+"'" 
⛔ `update t1 set c1='${v1}'`
👍 "update t1 set c1="+quoteLiteral(v1)
👍 `update t1 set c1 = ${quoteLiteral(v1)}`
  
⛔ 'update "'+t1+'" set c1 = null'
⛔ `update "${t1}" set c1 = null`
👍 'update '+quoteIdent(t1)+' set c1 = null'
👍 `update ${quoteIdent(t1)} set c1 = null`
```


## code injection in jQuery


How to avoid it?

> **Never, build HTML code by adding strings that contents data**


```js
⛔ $('#id').html('<p>'+value+'</p>')
👍 $('#id').append($('<p>').text(value))

⛔ $('#id').html('<img src="'+url+'">')
👍 $('#id').append($('<img>').attr('src',url))
```